<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.9" />
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html,
      body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: dark)').matches
      if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
        document.documentElement.classList.toggle('dark', true)
      }
    </script>
    <title>前端监控</title><meta name="description" content="啥也没得说">
    <link rel="preload" href="/richard_blog/assets/style-Ck8rbdsF.css" as="style"><link rel="stylesheet" href="/richard_blog/assets/style-Ck8rbdsF.css">
    <link rel="modulepreload" href="/richard_blog/assets/app-e94K_zRz.js"><link rel="modulepreload" href="/richard_blog/assets/index.html-BZcidVMH.js">
    <link rel="prefetch" href="/richard_blog/assets/index.html-ms3Ca4Vt.js" as="script"><link rel="prefetch" href="/richard_blog/assets/index.html-Cp6zfUmU.js" as="script"><link rel="prefetch" href="/richard_blog/assets/浏览器兼容性.html-BrxvSbAD.js" as="script"><link rel="prefetch" href="/richard_blog/assets/index.html-CTVDWfgZ.js" as="script"><link rel="prefetch" href="/richard_blog/assets/index.html-DcPk2_kq.js" as="script"><link rel="prefetch" href="/richard_blog/assets/webpack.html-DJFVDM-s.js" as="script"><link rel="prefetch" href="/richard_blog/assets/index.html-Bi_pI5YP.js" as="script"><link rel="prefetch" href="/richard_blog/assets/index.html-BFTFZOqX.js" as="script"><link rel="prefetch" href="/richard_blog/assets/index副本.html-BDLZ64Wd.js" as="script"><link rel="prefetch" href="/richard_blog/assets/index.html-B85mxSEH.js" as="script"><link rel="prefetch" href="/richard_blog/assets/index.html-BDPQHBTw.js" as="script"><link rel="prefetch" href="/richard_blog/assets/数据结构和算法.html-8RPj1v87.js" as="script"><link rel="prefetch" href="/richard_blog/assets/设计模式.html-CoBfURdf.js" as="script"><link rel="prefetch" href="/richard_blog/assets/index.html-DEPcZN0y.js" as="script"><link rel="prefetch" href="/richard_blog/assets/index.html-VgN-1AzX.js" as="script"><link rel="prefetch" href="/richard_blog/assets/index.html-DTcPLhso.js" as="script"><link rel="prefetch" href="/richard_blog/assets/index.html-BRtiylmY.js" as="script"><link rel="prefetch" href="/richard_blog/assets/index.html-DQx3mQaf.js" as="script"><link rel="prefetch" href="/richard_blog/assets/index.html-BgXnw5uj.js" as="script"><link rel="prefetch" href="/richard_blog/assets/index.html-6pJOZSrc.js" as="script"><link rel="prefetch" href="/richard_blog/assets/原理.html-DjSTyV85.js" as="script"><link rel="prefetch" href="/richard_blog/assets/index.html-LU4QDpV_.js" as="script"><link rel="prefetch" href="/richard_blog/assets/index.html-_AaV0qNF.js" as="script"><link rel="prefetch" href="/richard_blog/assets/eslint.html-BhEONVtF.js" as="script"><link rel="prefetch" href="/richard_blog/assets/prettier.html-C7KcAimk.js" as="script"><link rel="prefetch" href="/richard_blog/assets/规范搭建.html-BO6FVUnu.js" as="script"><link rel="prefetch" href="/richard_blog/assets/语法规范.html-D34TGmMl.js" as="script"><link rel="prefetch" href="/richard_blog/assets/404.html-CcK79zZq.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/richard_blog/"><!----><!----></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide" aria-label="site navigation"><!--[--><div class="navbar-item"><a class="route-link" href="/richard_blog/html/" aria-label="HTML"><!--[--><!--[--><!--]--> HTML <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/richard_blog/css/" aria-label="CSS"><!--[--><!--[--><!--]--> CSS <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="JS"><span class="title">JS</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="JS"><span class="title">JS</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="route-link" href="/richard_blog/js/" aria-label="JS基础"><!--[--><!--[--><!--]--> JS基础 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-item"><a class="route-link" href="/richard_blog/js/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html" aria-label="设计模式"><!--[--><!--[--><!--]--> 设计模式 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-item"><a class="route-link" href="/richard_blog/js/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95.html" aria-label="数据结构和算法"><!--[--><!--[--><!--]--> 数据结构和算法 <!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="route-link" href="/richard_blog/es6/" aria-label="ES6"><!--[--><!--[--><!--]--> ES6 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/richard_blog/vue2/" aria-label="VUE2"><!--[--><!--[--><!--]--> VUE2 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/richard_blog/vue3/" aria-label="VUE3"><!--[--><!--[--><!--]--> VUE3 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/richard_blog/react/" aria-label="react"><!--[--><!--[--><!--]--> react <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="浏览器"><span class="title">浏览器</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="浏览器"><span class="title">浏览器</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="route-link" href="/richard_blog/browser/" aria-label="浏览器基础"><!--[--><!--[--><!--]--> 浏览器基础 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-item"><a class="route-link" href="/richard_blog/browser/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7.html" aria-label="浏览器兼容"><!--[--><!--[--><!--]--> 浏览器兼容 <!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="route-link" href="/richard_blog/computerNetwork/" aria-label="计算机网络"><!--[--><!--[--><!--]--> 计算机网络 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/richard_blog/performance/" aria-label="性能优化"><!--[--><!--[--><!--]--> 性能优化 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/richard_blog/writeCode/" aria-label="手写代码"><!--[--><!--[--><!--]--> 手写代码 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/richard_blog/wxsp/" aria-label="小程序"><!--[--><!--[--><!--]--> 小程序 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="工程化"><span class="title">工程化</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="工程化"><span class="title">工程化</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="route-link" href="/richard_blog/engineering/" aria-label="是什么"><!--[--><!--[--><!--]--> 是什么 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>代码规范</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="route-link" href="/richard_blog/engineering/standard/eslint.html" aria-label="eslint"><!--[--><!--[--><!--]--> eslint <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/richard_blog/engineering/standard/prettier.html" aria-label="prettier"><!--[--><!--[--><!--]--> prettier <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/richard_blog/engineering/standard/%E8%A7%84%E8%8C%83%E6%90%AD%E5%BB%BA.html" aria-label="规范搭建"><!--[--><!--[--><!--]--> 规范搭建 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/richard_blog/engineering/standard/%E8%AF%AD%E6%B3%95%E8%A7%84%E8%8C%83.html" aria-label="语法规范"><!--[--><!--[--><!--]--> 语法规范 <!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>项目构建</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="route-link" href="/richard_blog/engineering/webpack.html" aria-label="webpack"><!--[--><!--[--><!--]--> webpack <!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="route-link" href="/richard_blog/studyRoute/" aria-label="学习路线"><!--[--><!--[--><!--]--> 学习路线 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/richard_blog/projectSolution/" aria-label="项目"><!--[--><!--[--><!--]--> 项目 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/richard_blog/noWrite/" aria-label="待写"><!--[--><!--[--><!--]--> 待写 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link route-link-active" href="/richard_blog/jiankong/" aria-label="前端监控"><!--[--><!--[--><!--]--> 前端监控 <!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items" aria-label="site navigation"><!--[--><div class="navbar-item"><a class="route-link" href="/richard_blog/html/" aria-label="HTML"><!--[--><!--[--><!--]--> HTML <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/richard_blog/css/" aria-label="CSS"><!--[--><!--[--><!--]--> CSS <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="JS"><span class="title">JS</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="JS"><span class="title">JS</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="route-link" href="/richard_blog/js/" aria-label="JS基础"><!--[--><!--[--><!--]--> JS基础 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-item"><a class="route-link" href="/richard_blog/js/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html" aria-label="设计模式"><!--[--><!--[--><!--]--> 设计模式 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-item"><a class="route-link" href="/richard_blog/js/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95.html" aria-label="数据结构和算法"><!--[--><!--[--><!--]--> 数据结构和算法 <!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="route-link" href="/richard_blog/es6/" aria-label="ES6"><!--[--><!--[--><!--]--> ES6 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/richard_blog/vue2/" aria-label="VUE2"><!--[--><!--[--><!--]--> VUE2 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/richard_blog/vue3/" aria-label="VUE3"><!--[--><!--[--><!--]--> VUE3 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/richard_blog/react/" aria-label="react"><!--[--><!--[--><!--]--> react <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="浏览器"><span class="title">浏览器</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="浏览器"><span class="title">浏览器</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="route-link" href="/richard_blog/browser/" aria-label="浏览器基础"><!--[--><!--[--><!--]--> 浏览器基础 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-item"><a class="route-link" href="/richard_blog/browser/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7.html" aria-label="浏览器兼容"><!--[--><!--[--><!--]--> 浏览器兼容 <!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="route-link" href="/richard_blog/computerNetwork/" aria-label="计算机网络"><!--[--><!--[--><!--]--> 计算机网络 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/richard_blog/performance/" aria-label="性能优化"><!--[--><!--[--><!--]--> 性能优化 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/richard_blog/writeCode/" aria-label="手写代码"><!--[--><!--[--><!--]--> 手写代码 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/richard_blog/wxsp/" aria-label="小程序"><!--[--><!--[--><!--]--> 小程序 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="工程化"><span class="title">工程化</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="工程化"><span class="title">工程化</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="route-link" href="/richard_blog/engineering/" aria-label="是什么"><!--[--><!--[--><!--]--> 是什么 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>代码规范</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="route-link" href="/richard_blog/engineering/standard/eslint.html" aria-label="eslint"><!--[--><!--[--><!--]--> eslint <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/richard_blog/engineering/standard/prettier.html" aria-label="prettier"><!--[--><!--[--><!--]--> prettier <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/richard_blog/engineering/standard/%E8%A7%84%E8%8C%83%E6%90%AD%E5%BB%BA.html" aria-label="规范搭建"><!--[--><!--[--><!--]--> 规范搭建 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/richard_blog/engineering/standard/%E8%AF%AD%E6%B3%95%E8%A7%84%E8%8C%83.html" aria-label="语法规范"><!--[--><!--[--><!--]--> 语法规范 <!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>项目构建</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="route-link" href="/richard_blog/engineering/webpack.html" aria-label="webpack"><!--[--><!--[--><!--]--> webpack <!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="route-link" href="/richard_blog/studyRoute/" aria-label="学习路线"><!--[--><!--[--><!--]--> 学习路线 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/richard_blog/projectSolution/" aria-label="项目"><!--[--><!--[--><!--]--> 项目 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/richard_blog/noWrite/" aria-label="待写"><!--[--><!--[--><!--]--> 待写 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link route-link-active" href="/richard_blog/jiankong/" aria-label="前端监控"><!--[--><!--[--><!--]--> 前端监控 <!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">前端监控 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="#为什么要做前端监控" aria-label="为什么要做前端监控?"><!--[--><!--[--><!--]--> 为什么要做前端监控? <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#怎么做" aria-label="怎么做？"><!--[--><!--[--><!--]--> 怎么做？ <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#需要监控什么" aria-label="需要监控什么？"><!--[--><!--[--><!--]--> 需要监控什么？ <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#功能拆分" aria-label="功能拆分"><!--[--><!--[--><!--]--> 功能拆分 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#初始化" aria-label="初始化"><!--[--><!--[--><!--]--> 初始化 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#错误监控" aria-label="错误监控"><!--[--><!--[--><!--]--> 错误监控 <!--[--><!--]--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="#错误类型" aria-label="错误类型"><!--[--><!--[--><!--]--> 错误类型 <!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link sidebar-item" href="#用户埋点统计" aria-label="用户埋点统计"><!--[--><!--[--><!--]--> 用户埋点统计 <!--[--><!--]--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="#手动埋点" aria-label="手动埋点"><!--[--><!--[--><!--]--> 手动埋点 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#无痕埋点" aria-label="无痕埋点"><!--[--><!--[--><!--]--> 无痕埋点 <!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link sidebar-item" href="#pv统计" aria-label="PV统计"><!--[--><!--[--><!--]--> PV统计 <!--[--><!--]--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="#history路由" aria-label="history路由"><!--[--><!--[--><!--]--> history路由 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#hash路由" aria-label="hash路由"><!--[--><!--[--><!--]--> hash路由 <!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link sidebar-item" href="#uv统计" aria-label="UV统计"><!--[--><!--[--><!--]--> UV统计 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#数据上报" aria-label="数据上报"><!--[--><!--[--><!--]--> 数据上报 <!--[--><!--]--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="#合并上报" aria-label="合并上报"><!--[--><!--[--><!--]--> 合并上报 <!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link sidebar-item" href="#window-onerror-和-window-addeventlistener-error-的区别" aria-label="window.onerror 和 window.addEventListener(&#39;error&#39;) 的区别"><!--[--><!--[--><!--]--> window.onerror 和 window.addEventListener(&#39;error&#39;) 的区别 <!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="前端监控" tabindex="-1"><a class="header-anchor" href="#前端监控"><span>前端监控</span></a></h1><h2 id="为什么要做前端监控" tabindex="-1"><a class="header-anchor" href="#为什么要做前端监控"><span>为什么要做前端监控?</span></a></h2><p>思考一下，我们的项目代码在上线之后是不是就不用管了呢？并不是，作为前端开发工程师，我们是直接跟用户打交道的，一个应用的用户留存率跟这个应用的稳定性有很大的关系，因为监控能让我们快速的发现并解决问题，所以一个系统的监控体系越完善这个系统就越稳定。所以不光后端要对接口做监控，前端的监控也显得很重要。</p><p>对于我们来说，学习如何做前端的监控一方面可以拓宽我们的知识面，另一方面可以在面试的时候加分，让面试官觉得我们不只是在公司整天的写业务代码，也有技术上的产出，不至于面试的时候问到这方面的问题完全摸不着头脑。</p><ul><li>更快发现问题和解决问题</li><li>做产品的决策依据</li><li>提升前端工程师的技术深度和广度,打造简历亮点</li><li>为业务扩展提供了更多可能性</li></ul><h2 id="怎么做" tabindex="-1"><a class="header-anchor" href="#怎么做"><span>怎么做？</span></a></h2><ul><li><p>接入现成的</p><ol><li><p>sentry <a href="https://docs.sentry.io/" target="_blank" rel="noopener noreferrer">https://docs.sentry.io/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p>fundebug <a href="https://www.fundebug.com/" target="_blank" rel="noopener noreferrer">https://www.fundebug.com/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li></ol></li><li><p>自己封装</p></li></ul><h2 id="需要监控什么" tabindex="-1"><a class="header-anchor" href="#需要监控什么"><span>需要监控什么？</span></a></h2><ul><li><p>错误统计</p><p>首先，我们的代码发布到线上总是会发生奇奇怪怪的错误，错误原因也五花八门，可能是浏览器兼容问题，可能是代码里面没做兜底，也可能是后端接口挂掉了等等错误，可能随便一个错误都会影响用户的使用，所以对线上进行错误监控显的尤为重要，能够让我们第一时间去响应报错并解决。</p></li><li><p>行为日志埋点</p><p>对于一些常见的电商app，比如淘宝，都有一套自己的用户行为分析的系统，分析用户浏览时间比较长的页面有哪些，常点击的按钮有哪些等等行为，通过分析用户的这些行为去制定不同的策略引导你购物，这些都可以通过前端埋点去实现对用户行为的监控。</p></li><li><p>PV/UV统计</p><p>我们上线那么多的前端页面，肯定特别想知道我们的用户对哪个页面的访问次数比较多，也想知道每天有多少的用户访问我们的系统，这就需要用到PV,UV的统计</p></li></ul><p>所以我们系统的设计就主要围绕上面着三点进行设计，主要流程如下：</p><p>数据采集：数据采集做的就是采集我们系统的监控数据，包括PV,UV和用户行为及前端报错的数据。</p><p>日志上报：上报做的就是将第一步采集到的数据发送到服务端。</p><p>日志查询：这一步就是在后台查询我们采集并上报的数据，方便对系统进行分析。</p><p>我们的SDK做的主要是对前两部分的实现。</p><h2 id="功能拆分" tabindex="-1"><a class="header-anchor" href="#功能拆分"><span>功能拆分</span></a></h2><h2 id="初始化" tabindex="-1"><a class="header-anchor" href="#初始化"><span>初始化</span></a></h2><p>初始化其实很简单，就是获取用户传过来的参数，然后调用我们的初始化函数就可以了，在初始化函数中，我们可以注入一些监听事件来实现数据统计的功能。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// 1.加载配置 2.监控代码注入</span>
<span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">loadConfig</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 加载配置</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="错误监控" tabindex="-1"><a class="header-anchor" href="#错误监控"><span>错误监控</span></a></h2><blockquote><p>前端是直接和用户打交道的，前端页面报错是很影响用户体验一件事，即使在测试充分后上线也会因为用户的操作行为以及操作的环境出现各种各样的错误，所以，不光是后端需要加报警监控，前端的错误监控也很重要。</p></blockquote><h3 id="错误类型" tabindex="-1"><a class="header-anchor" href="#错误类型"><span>错误类型</span></a></h3><ol><li><p>语法错误</p><p>语法错误一般在可发阶段就可以发现，比如常见的单词拼写错误，中英文符号错误等。注意：语法错误是无法被try catch捕获的，因为在开发阶段就能发现，所以一般不会发布到线上环境。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> name <span class="token operator">=</span> &#39;heima<span class="token punctuation">;</span> <span class="token comment">// 少一个单引号</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;----捕获到了语法错误-----&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>同步错误</p><p>同步错误指的是在js同步执行过程中的错误，比如变量未定义，是可以被try catch给捕获到的</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">&#39;heima&#39;</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>nam<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;------同步错误-------&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>异步错误</p><p>异步错误指的是在setTimeout等函数中发生的错误，是无法被try catch捕获到的</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">undefined</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;-----异步错误-----&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>异步错误的话我们可以用window.onerror来进行处理，这个方法比try catch要强大很多</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>String<span class="token punctuation">}</span></span>  <span class="token parameter">msg</span>    错误描述
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>String<span class="token punctuation">}</span></span>  <span class="token parameter">url</span>    报错文件
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Number<span class="token punctuation">}</span></span>  <span class="token parameter">row</span>    行号
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Number<span class="token punctuation">}</span></span>  <span class="token parameter">col</span>    列号
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Object<span class="token punctuation">}</span></span>  <span class="token parameter">error</span>  错误Error对象
 */</span>
 window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> url<span class="token punctuation">,</span> row<span class="token punctuation">,</span> col<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;出错了！！！&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>col<span class="token punctuation">)</span><span class="token punctuation">;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>promise错误</p><p>在 <code>promise</code> 中使用 <code>catch</code> 可以捕获到异步的错误，但是如果没有写 <code>catch</code> 去捕获错误的话 <code>window.onerror</code> 也捕获不到的，所以写 <code>promise</code> 的时候最好要写上 <code>catch</code> ，或者可以在全局加上 <code>unhandledrejection</code> 的监听，用来监听没有被捕获的promise错误。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;unhandledrejection&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;捕获到异常：&#39;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>资源加载错误</p><p>资源加载错误指的是比如一些资源文件获取失败，可能是服务器挂掉了等原因造成的，出现这种情况就比较严重了，所以需要能够及时的处理，网路错误一般用 <code>window.addEventListener</code> 来捕获。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><blockquote><p>所以SDK错误监控的实现，就是围绕这几种错误实现的。 <code>try-catch</code> 用来在可预见情况下监控特定的错误，<code>window.onerror</code> 主要是来捕获预料之外的错误，比如异步错误。但是 <code>window.onerror</code> 也并不是万能的，它可以捕获语法，同步，异步的错误，但是对于promise错误以及网络错误还是无能为力，所以还需要 <code>unhandledrejection</code> 监听来捕获promise错误，最后，再加上 <code>error</code> 监听捕获资源加载的错误就能将各种类型的错误全覆盖了。</p></blockquote><h2 id="用户埋点统计" tabindex="-1"><a class="header-anchor" href="#用户埋点统计"><span>用户埋点统计</span></a></h2><blockquote><p>埋点是监控用户在我们应用上的一些动作表现，是不是经常感觉有些应用推荐的内容都是自己感兴趣的，这就是埋点这个“内鬼”在搞怪，比如你在淘宝上的某类型的鞋子的页面浏览了几分钟，那么就会有一个“张三在2022-7-16 15:30搜索了某款运动鞋并浏览了十分钟”的记录的上报，后台就可以根据这些上报的数据去分析用户的行为，并且制定之后推送或者产品的迭代优化等，对于产品后续的发展起着重要作用。埋点又分为手动埋点和无痕埋点。</p></blockquote><h3 id="手动埋点" tabindex="-1"><a class="header-anchor" href="#手动埋点"><span>手动埋点</span></a></h3><blockquote><p>手动埋点就是手动的在代码里面添加相关的埋点代码，比如用户点击某个按钮，就在这个按钮的点击事件中加入相关的埋点代码，或者提交了一个表单，就在这个提交事件中加入埋点代码。</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// 方式1</span>
<span class="token operator">&lt;</span>button
  onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 业务代码</span>
   <span class="token function">tracker</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;用户去支付&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// tracker(&#39;visit&#39;, &#39;访问新页面&#39;);</span>
    <span class="token comment">// tracker(&#39;submit&#39;, &#39;提交表单&#39;);</span>
  <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">&gt;</span>手动埋点<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// 方式2</span>
<span class="token operator">&lt;</span>button 
 data<span class="token operator">-</span>target<span class="token operator">=</span><span class="token string">&quot;支付按钮&quot;</span>
 onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 业务代码</span>
  <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">&gt;</span>手动上报<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>优点：可控性强，可以自定义上报具体的数据。</li><li>缺点：对业务代码侵入性强，如果有很多地方需要埋点就得一个一个手动的去添加埋点代码。</li></ul><h3 id="无痕埋点" tabindex="-1"><a class="header-anchor" href="#无痕埋点"><span>无痕埋点</span></a></h3><blockquote><p>无痕埋点是为了解决手动埋点的缺点，实现一种不用侵入业务代码就能在应用中添加埋点监控的埋点方式。</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 业务代码</span>
<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>自动埋点<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// 自动埋点实现</span>
<span class="token keyword">function</span> <span class="token function">autoTracker</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 添加全局click监听</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> clickedDom <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">;</span>
    <span class="token comment">// 获取data-target属性值</span>
    <span class="token keyword">let</span> target <span class="token operator">=</span> clickedDom<span class="token operator">?.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;data-target&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果设置data-target属性就上报对应的值--手动埋点</span>
      <span class="token function">tracker</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果没有设置data-target属性就上报被点击元素的html路径</span>
      <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">getPathTo</span><span class="token punctuation">(</span>clickedDom<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">tracker</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>优点：不用侵入务代码就能实现全局的埋点。</li><li>缺点：只能上报基本的行为交互信息，无法上报自定义的数据；上报次数多，服务器性能压力大。</li></ul><h2 id="pv统计" tabindex="-1"><a class="header-anchor" href="#pv统计"><span>PV统计</span></a></h2><blockquote><p>PV即页面浏览量，用来表示该页面的访问数量</p></blockquote><p>在SPA应用之前只需要监听 <code>onload</code> 事件即可统计页面的PV，在SPA应用中，页面路由的切换完全由前端实现，主流的react和vue框架都有自己的路由管理库，而单页路由又区分为 <code>hash</code> 路由和 <code>history</code> 路由，两种路由的原理又不一样，所以统计起来会有点复杂。我们这里将分别针对两种路由来实现不同的采集数据的方式。</p><h3 id="history路由" tabindex="-1"><a class="header-anchor" href="#history路由"><span>history路由</span></a></h3><p>history路由依赖全局对象 <code>history</code> 实现的</p><ul><li>history.back(); // 返回上一页，和浏览器回退功能一样</li><li>history.forward(); // 前进一页，和浏览器前进功能一样</li><li>history.go(); // 跳转到历史记录中的某一页, eg: history.go(-1); history.go(1)</li><li>history.pushState(); // 添加新的历史记录</li><li>history.replaceState(); // 修改当前的记录项</li></ul><p>history路由的实现主要依赖的就是 <code>pushState</code> 和 <code>replaceState</code> 来实现的，但是这两种方法不能被 <code>popstate</code> 监听到，所以需要对这两种方法进行重写来实现数据的采集。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * 重写pushState和replaceState方法
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">name</span> 
 * <span class="token keyword">@returns</span> 
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">createHistoryEvent</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 拿到原来的处理方法</span>
  <span class="token keyword">const</span> origin <span class="token operator">=</span> window<span class="token punctuation">.</span>history<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> <span class="token string">&#39;replaceState&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> current <span class="token punctuation">}</span> <span class="token operator">=</span> event<span class="token punctuation">;</span>
      <span class="token keyword">const</span> pathName <span class="token operator">=</span> location<span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">===</span> pathName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token function">origin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token function">origin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Event</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    e<span class="token punctuation">.</span>arguments <span class="token operator">=</span> arguments<span class="token punctuation">;</span>
    window<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span>history<span class="token punctuation">.</span>pushState <span class="token operator">=</span> <span class="token function">createHistoryEvent</span><span class="token punctuation">(</span><span class="token string">&#39;pushState&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>history<span class="token punctuation">.</span>replaceState <span class="token operator">=</span> <span class="token function">createHistoryEvent</span><span class="token punctuation">(</span><span class="token string">&#39;replaceState&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> stayTime <span class="token operator">=</span> <span class="token function">getStayTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 停留时间</span>
  <span class="token keyword">const</span> currentPage <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">;</span> <span class="token comment">// 页面路径</span>
  <span class="token function">lazyReport</span><span class="token punctuation">(</span><span class="token string">&#39;visit&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    stayTime<span class="token punctuation">,</span>
    <span class="token literal-property property">page</span><span class="token operator">:</span> beforePage<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  beforePage <span class="token operator">=</span> currentPage<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// history.go()、history.back()、history.forward() 监听</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;popstate&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// history.pushState</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pushState&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// history.replaceState</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;replaceState&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="hash路由" tabindex="-1"><a class="header-anchor" href="#hash路由"><span>hash路由</span></a></h3><p>url上hash的改变会出发 <code>hashchange</code> 的监听，所以我们只需要在全局加上一个监听函数，在监听函数中实现采集并上报就可以了。但是在react和vue中，对于hash路由的跳转并不是通过 <code>hashchange</code> 的监听实现的，而是通过 <code>pushState</code> 实现，所以，还需要加上对 <code>pushState</code> 的监听才可以。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">hashPageTrackerReport</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> beforeTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 进入页面的时间</span>
  <span class="token keyword">let</span> beforePage <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 上一个页面</span>
  
  <span class="token comment">// 上报</span>
  <span class="token keyword">function</span> <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> stayTime <span class="token operator">=</span> <span class="token function">getStayTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> currentPage <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">;</span>
      <span class="token function">lazyReport</span><span class="token punctuation">(</span><span class="token string">&#39;visit&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      stayTime<span class="token punctuation">,</span>
      <span class="token literal-property property">page</span><span class="token operator">:</span> beforePage<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    beforePage <span class="token operator">=</span> currentPage<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// hash路由监听</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;hashchange&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="uv统计" tabindex="-1"><a class="header-anchor" href="#uv统计"><span>UV统计</span></a></h2><blockquote><p>UV统计的是一天内访问该网站的用户数</p></blockquote><p>uv统计比较简单，就只需要在SDK初始化的时候上报一条消息就可以了</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * 初始化配置
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">options</span> 
 */</span>
<span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span> <span class="token comment">// 加载配置</span>
  <span class="token function">report</span><span class="token punctuation">(</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;加载应用&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// uv统计</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="数据上报" tabindex="-1"><a class="header-anchor" href="#数据上报"><span>数据上报</span></a></h2><ol><li><p>xhr接口请求</p><p>采用接口请求的方式是最简单的，就跟请求其他业务接口一样，只不过上传的是埋点的数据。但是在通常的情况下，一般在公司里面处理埋点的服务器和处理业务逻辑的处理器不是同一台，所以还需要手动解决跨域的问题，另一方面，如果在上报的过程中刷新或者重新打开新页面，可能会造成埋点数据的缺失，所以传统的xhr接口请求的方式并不能很好的适应埋点的需求。</p></li><li><p>img标签</p><p>img标签的方式是通过将埋点数据伪装成图片URL的请求方式，这样就避免了跨域的问题，但是因为浏览器对url的长度会有限制，所以通过这种方式上报不适合大数据量上报的场景，而且也会存在刷新或者打开页面的时候上报的数据丢失的情况。</p></li><li><p>sendBeacon</p><p>鉴于以上两种方式的缺点，sendBeacon应运而生了，sendBeacon可以说是为埋点量身定做的，这种方式不会有跨域的限制，也不会存在因为刷新页面等情况造成数据丢失的情况，唯一的缺点就是在某些浏览器上存在兼容性的问题，所以在日常的开发场景中，通常采用sendBeacon上报和img标签上报结合的方式</p></li></ol><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code> <span class="token operator">*</span> 上报
 <span class="token operator">*</span> @param <span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span> type 
 <span class="token operator">*</span> @param <span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span> params 
 <span class="token operator">*</span><span class="token operator">/</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">report</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> appId <span class="token operator">=</span> window<span class="token punctuation">[</span><span class="token string">&#39;_monitor_app_id_&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> userId <span class="token operator">=</span> window<span class="token punctuation">[</span><span class="token string">&#39;_monitor_user_id_&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> window<span class="token punctuation">[</span><span class="token string">&#39;_monitor_report_url_&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> logParams <span class="token operator">=</span> <span class="token punctuation">{</span>
    appId<span class="token punctuation">,</span> <span class="token comment">// 项目的appId</span>
    userId<span class="token punctuation">,</span>
    type<span class="token punctuation">,</span> <span class="token comment">// error/action/visit/user</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> params<span class="token punctuation">,</span> <span class="token comment">// 上报的数据</span>
    <span class="token literal-property property">currentTime</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 时间戳</span>
    <span class="token literal-property property">currentPage</span><span class="token operator">:</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">,</span> <span class="token comment">// 当前页面</span>
    <span class="token literal-property property">ua</span><span class="token operator">:</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">,</span> <span class="token comment">// ua信息</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> logParamsString <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>logParams<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>sendBeacon<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 支持sendBeacon的浏览器</span>
    navigator<span class="token punctuation">.</span><span class="token function">sendBeacon</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> logParamsString<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 不支持sendBeacon的浏览器</span>
    <span class="token keyword">let</span> oImage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    oImage<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?logs=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>logParamsString<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="合并上报" tabindex="-1"><a class="header-anchor" href="#合并上报"><span>合并上报</span></a></h3><p>对于无痕埋点来说，一次点击就进行一次上报对服务器来说压力有点大，所以最好是能进行一个合并上报。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// cache.js</span>
<span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> cache<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">addCache</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  cache<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// lazyReport.js</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">lazyReport</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ....</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">getCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>delay <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// delay=0相当于不做延迟上报</span>
    <span class="token function">report</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 数据达到10条上报</span>
    <span class="token function">report</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 合并上报</span>
    <span class="token function">report</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="window-onerror-和-window-addeventlistener-error-的区别" tabindex="-1"><a class="header-anchor" href="#window-onerror-和-window-addeventlistener-error-的区别"><span>window.onerror 和 window.addEventListener(&#39;error&#39;) 的区别</span></a></h2><p>window.onerror 和 window.addEventListener(&#39;error&#39;, handler) 都用于捕获 JavaScript 运行时错误，但它们之间有一些关键区别：</p><p>window.onerror：</p><p>window.onerror 是一个全局属性，用于指定全局的错误处理函数。 它可以被用来捕获未被捕获的 JavaScript 运行时错误（如语法错误、未捕获的异常等）。 该属性的值是一个函数，当出现错误时，这个函数会被调用，并传递一些关于错误的信息，如错误消息、URL、行号、列号等。 window.onerror 可以设置为一个新的函数，来替换默认的错误处理函数。如果函数返回 true，则表示告知浏览器已经处理了错误，浏览器不会再向控制台输出错误信息。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> source<span class="token punctuation">,</span> lineno<span class="token punctuation">,</span> colno<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 处理错误</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 告知浏览器已经处理了错误</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>window.addEventListener(&#39;error&#39;, handler)：</p><p>window.addEventListener(&#39;error&#39;, handler) 是一个事件监听器，用于捕获页面上发生的非同步错误，比如 JavaScript 运行时错误、资源加载错误等。 通过此方法添加的事件处理程序可以捕获到更多类型的错误，而不仅仅是 JavaScript 运行时错误。 当发生错误时，事件处理程序会被调用，并传递一个包含错误信息的 Event 对象。 可以使用 removeEventListener() 方法来移除事件监听器。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 处理错误</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>总的来说，window.onerror 主要用于捕获全局的 JavaScript 运行时错误，而 window.addEventListener(&#39;error&#39;, handler) 则可以用于捕获更广泛范围的错误，包括非同步的错误。</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1324980809@qq.com">zqy</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/richard_blog/assets/app-e94K_zRz.js" defer></script>
  </body>
</html>
